# üì¶ Guia Completo: Semantic-Release do Zero

## üìã √çndice

1. [O que √© o Semantic-Release](#o-que-√©-o-semantic-release)
2. [Pr√©-requisitos](#pr√©-requisitos)
3. [Instala√ß√£o Passo a Passo](#instala√ß√£o-passo-a-passo)
4. [Configura√ß√£o B√°sica](#configura√ß√£o-b√°sica)
5. [Conven√ß√£o de Commits](#conven√ß√£o-de-commits)
6. [Configura√ß√£o Avan√ßada](#configura√ß√£o-avan√ßada)
7. [GitHub Actions](#github-actions)
8. [Tokens e Autentica√ß√£o](#tokens-e-autentica√ß√£o)
9. [Primeira Release](#primeira-release)
10. [Troubleshooting](#troubleshooting)

---

## ü§î O que √© o Semantic-Release

O **Semantic-Release** √© uma ferramenta que automatiza todo o processo de versionamento e publica√ß√£o de pacotes, incluindo:

- üîç **An√°lise de commits** para determinar o tipo de release
- üìà **Versionamento autom√°tico** seguindo Semantic Versioning (SemVer)
- üìù **Gera√ß√£o de changelog** autom√°tico
- üè∑Ô∏è **Cria√ß√£o de tags Git** 
- üì¶ **Publica√ß√£o no NPM**
- üöÄ **Cria√ß√£o de releases no GitHub**

### üéØ Benef√≠cios

- ‚úÖ **Zero configura√ß√£o manual** de vers√µes
- ‚úÖ **Changelog sempre atualizado**
- ‚úÖ **Processo padronizado** entre projetos
- ‚úÖ **Integra√ß√£o com CI/CD**
- ‚úÖ **Redu√ß√£o de erros humanos**

---

## üõ†Ô∏è Pr√©-requisitos

Antes de come√ßar, certifique-se de ter:

- ‚úÖ **Node.js** (vers√£o 18 ou superior)
- ‚úÖ **Git** configurado
- ‚úÖ **Reposit√≥rio Git** inicializado
- ‚úÖ **package.json** b√°sico
- ‚úÖ **Conta no GitHub** (opcional, para releases)
- ‚úÖ **Conta no NPM** (opcional, para publica√ß√£o)

### Verifica√ß√£o dos Pr√©-requisitos

```bash
# Verificar Node.js
node --version

# Verificar NPM
npm --version

# Verificar Git
git --version

# Verificar se est√° em um reposit√≥rio Git
git status
```

---

## üì¶ Instala√ß√£o Passo a Passo

### 1. Criar/Preparar o Projeto

```bash
# Se for um projeto novo
mkdir meu-projeto
cd meu-projeto
npm init -y

# Inicializar Git (se ainda n√£o foi feito)
git init
git remote add origin https://github.com/usuario/meu-projeto.git
```

### 2. Instalar o Semantic-Release

```bash
# Instalar como depend√™ncia de desenvolvimento
npm install --save-dev semantic-release

# Instalar plugins essenciais
npm install --save-dev @semantic-release/changelog
npm install --save-dev @semantic-release/git
npm install --save-dev @semantic-release/github
npm install --save-dev @semantic-release/npm
```

### 3. Verificar Instala√ß√£o

```bash
# Verificar se foi instalado corretamente
npx semantic-release --version
```

---

## ‚öôÔ∏è Configura√ß√£o B√°sica

### 1. Configurar package.json

Edite seu `package.json`:

```json
{
  "name": "meu-projeto",
  "version": "0.0.0",
  "description": "Descri√ß√£o do projeto",
  "main": "index.js",
  "scripts": {
    "semantic-release": "semantic-release"
  },
  "repository": {
    "type": "git",
    "url": "https://github.com/usuario/meu-projeto.git"
  },
  "author": "Seu Nome",
  "license": "MIT",
  "devDependencies": {
    "semantic-release": "^24.0.0",
    "@semantic-release/changelog": "^6.0.0",
    "@semantic-release/git": "^10.0.0",
    "@semantic-release/github": "^10.0.0",
    "@semantic-release/npm": "^12.0.0"
  }
}
```

**‚ö†Ô∏è Importante**: 
- Remove `"private": true` se quiser publicar no NPM
- A vers√£o deve ser `"0.0.0"` (ser√° gerenciada automaticamente)

### 2. Criar Arquivo de Configura√ß√£o

Para projetos **ES Modules** (type: "module"):

```javascript
// .releaserc.mjs
export default {
  branches: ["main"],
  plugins: [
    "@semantic-release/commit-analyzer",
    "@semantic-release/release-notes-generator",
    "@semantic-release/changelog",
    "@semantic-release/npm",
    [
      "@semantic-release/git",
      {
        assets: ["CHANGELOG.md", "package.json"],
        message: "chore(release): ${nextRelease.version} [skip ci]\\n\\n${nextRelease.notes}",
      },
    ],
    "@semantic-release/github",
  ],
  repositoryUrl: "https://github.com/usuario/meu-projeto",
};
```

Para projetos **CommonJS**:

```javascript
// .releaserc.js
module.exports = {
  branches: ["main"],
  plugins: [
    "@semantic-release/commit-analyzer",
    "@semantic-release/release-notes-generator", 
    "@semantic-release/changelog",
    "@semantic-release/npm",
    [
      "@semantic-release/git",
      {
        assets: ["CHANGELOG.md", "package.json"],
        message: "chore(release): ${nextRelease.version} [skip ci]\\n\\n${nextRelease.notes}",
      },
    ],
    "@semantic-release/github",
  ],
  repositoryUrl: "https://github.com/usuario/meu-projeto",
};
```

---

## üìù Conven√ß√£o de Commits

O semantic-release funciona baseado na **Conventional Commits**:

### Tipos de Commit e Impacto na Vers√£o

| Tipo | Descri√ß√£o | Incremento | Exemplo |
|------|-----------|------------|---------|
| `fix:` | Corre√ß√£o de bug | **PATCH** (1.0.0 ‚Üí 1.0.1) | `fix: corrigir erro na valida√ß√£o` |
| `feat:` | Nova funcionalidade | **MINOR** (1.0.0 ‚Üí 1.1.0) | `feat: adicionar login social` |
| `BREAKING CHANGE:` | Mudan√ßa incompat√≠vel | **MAJOR** (1.0.0 ‚Üí 2.0.0) | `feat!: alterar API de usu√°rios` |
| `docs:` | Apenas documenta√ß√£o | **NENHUM** | `docs: atualizar README` |
| `style:` | Formata√ß√£o/estilo | **NENHUM** | `style: corrigir indenta√ß√£o` |
| `refactor:` | Refatora√ß√£o | **NENHUM** | `refactor: simplificar fun√ß√£o` |
| `test:` | Testes | **NENHUM** | `test: adicionar teste unit√°rio` |
| `chore:` | Manuten√ß√£o | **NENHUM** | `chore: atualizar depend√™ncias` |

### üìã Exemplos Pr√°ticos

```bash
# ‚úÖ PATCH - Corre√ß√£o de bug
git commit -m "fix: corrigir erro de valida√ß√£o de email"

# ‚úÖ MINOR - Nova funcionalidade  
git commit -m "feat: adicionar autentica√ß√£o com Google"

# ‚úÖ MAJOR - Breaking change
git commit -m "feat!: alterar estrutura da API de usu√°rios

BREAKING CHANGE: A API agora retorna objetos diferentes"

# ‚úÖ Documenta√ß√£o (n√£o gera release)
git commit -m "docs: adicionar exemplos no README"

# ‚ùå ERRADO - N√£o segue conven√ß√£o
git commit -m "corrigido bug"
git commit -m "novo feature"
```

---

## üîß Configura√ß√£o Avan√ßada

### 1. Configura√ß√£o Personalizada de Plugins

```javascript
// .releaserc.mjs
export default {
  branches: [
    "main",
    { name: "beta", prerelease: true },
    { name: "alpha", prerelease: true }
  ],
  plugins: [
    // An√°lise de commits personalizada
    [
      "@semantic-release/commit-analyzer",
      {
        preset: "angular",
        releaseRules: [
          { type: "docs", scope: "README", release: "patch" },
          { type: "refactor", release: "patch" },
          { scope: "no-release", release: false },
        ],
      },
    ],
    
    // Gera√ß√£o de notas personalizadas
    [
      "@semantic-release/release-notes-generator",
      {
        preset: "angular",
        presetConfig: {
          types: [
            { type: "feat", section: "üöÄ Funcionalidades" },
            { type: "fix", section: "üêõ Corre√ß√µes" },
            { type: "docs", section: "üìù Documenta√ß√£o" },
            { type: "style", section: "üíÑ Estilo" },
            { type: "refactor", section: "‚ôªÔ∏è Refatora√ß√£o" },
            { type: "test", section: "‚úÖ Testes" },
            { type: "chore", section: "üîß Manuten√ß√£o" },
          ],
        },
      },
    ],
    
    // Changelog personalizado
    [
      "@semantic-release/changelog",
      {
        changelogFile: "CHANGELOG.md",
        changelogTitle: "# üìã Changelog\\n\\nTodas as mudan√ßas not√°veis neste projeto ser√£o documentadas neste arquivo.",
      },
    ],
    
    // Configura√ß√£o NPM
    [
      "@semantic-release/npm",
      {
        npmPublish: true,
        tarballDir: "dist",
      },
    ],
    
    // Configura√ß√£o Git
    [
      "@semantic-release/git",
      {
        assets: ["CHANGELOG.md", "package.json", "package-lock.json"],
        message: "chore(release): ${nextRelease.version} [skip ci]\\n\\n${nextRelease.notes}",
      },
    ],
    
    // Configura√ß√£o GitHub
    [
      "@semantic-release/github",
      {
        assets: [
          { path: "dist/*.tgz", label: "Pacote NPM" },
          { path: "dist/*.zip", label: "C√≥digo fonte" },
        ],
        successComment: "üéâ Esta issue foi resolvida na vers√£o ${nextRelease.version}",
      },
    ],
  ],
  repositoryUrl: "https://github.com/usuario/meu-projeto",
};
```

### 2. Configura√ß√£o por Ambiente

```javascript
// .releaserc.mjs
const config = {
  branches: ["main"],
  plugins: [
    "@semantic-release/commit-analyzer",
    "@semantic-release/release-notes-generator",
    "@semantic-release/changelog",
    [
      "@semantic-release/git",
      {
        assets: ["CHANGELOG.md", "package.json"],
        message: "chore(release): ${nextRelease.version} [skip ci]\\n\\n${nextRelease.notes}",
      },
    ],
  ],
  repositoryUrl: "https://github.com/usuario/meu-projeto",
};

// Adicionar plugins apenas em produ√ß√£o (CI)
if (process.env.CI) {
  config.plugins.push("@semantic-release/npm");
  config.plugins.push("@semantic-release/github");
}

export default config;
```

---

## ü§ñ GitHub Actions

### 1. Criar Workflow

Crie o arquivo `.github/workflows/release.yml`:

```yaml
name: Release

on:
  push:
    branches:
      - main

permissions:
  contents: read

jobs:
  release:
    name: Release
    runs-on: ubuntu-latest
    
    # Permiss√µes necess√°rias para o semantic-release
    permissions:
      contents: write        # Para criar tags e releases
      issues: write         # Para comentar em issues
      pull-requests: write  # Para comentar em PRs
      id-token: write      # Para provenance do NPM
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Buscar todo o hist√≥rico
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "lts/*"
          cache: "npm"
      
      - name: Install dependencies
        run: npm clean-install
      
      - name: Verify the integrity of provenance attestations and registry signatures
        run: npm audit signatures
      
      - name: Build (se necess√°rio)
        run: npm run build --if-present
      
      - name: Run tests (se houver)
        run: npm test --if-present
      
      - name: Release
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          NPM_TOKEN: ${{ secrets.NPM_TOKEN }}
        run: npx semantic-release
```

### 2. Workflow Mais Completo

```yaml
name: CI/CD Pipeline

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    name: Test
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: "lts/*"
          cache: "npm"
      
      - run: npm ci
      - run: npm run lint --if-present
      - run: npm test --if-present
      - run: npm run build --if-present

  release:
    name: Release
    needs: test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    
    permissions:
      contents: write
      issues: write
      pull-requests: write
      id-token: write
    
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
          
      - uses: actions/setup-node@v4
        with:
          node-version: "lts/*"
          cache: "npm"
      
      - run: npm ci
      - run: npm run build --if-present
      
      - name: Release
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          NPM_TOKEN: ${{ secrets.NPM_TOKEN }}
        run: npx semantic-release
```

---

## üîë Tokens e Autentica√ß√£o

### 1. GitHub Token

O `GITHUB_TOKEN` √© fornecido automaticamente pelo GitHub Actions, mas voc√™ pode criar um Personal Access Token para mais controle:

#### Criando um Personal Access Token:

1. V√° para **GitHub** ‚Üí **Settings** ‚Üí **Developer settings** ‚Üí **Personal access tokens** ‚Üí **Tokens (classic)**
2. Clique em **Generate new token (classic)**
3. Defina as permiss√µes:
   - ‚úÖ `repo` (acesso completo ao reposit√≥rio)
   - ‚úÖ `write:packages` (para publicar pacotes)
4. Copie o token

#### Configurando no GitHub:

1. V√° para seu reposit√≥rio ‚Üí **Settings** ‚Üí **Secrets and variables** ‚Üí **Actions**
2. Clique em **New repository secret**
3. Nome: `GITHUB_TOKEN`
4. Valor: Seu token

### 2. NPM Token

Para publicar no NPM, voc√™ precisa de um token:

#### Criando NPM Token:

1. Fa√ßa login em [npmjs.com](https://www.npmjs.com)
2. V√° para **Account** ‚Üí **Access Tokens**
3. Clique em **Generate New Token**
4. Escolha **Automation** (para CI/CD)
5. Copie o token

#### Configurando no GitHub:

1. V√° para seu reposit√≥rio ‚Üí **Settings** ‚Üí **Secrets and variables** ‚Üí **Actions**
2. Clique em **New repository secret**
3. Nome: `NPM_TOKEN`
4. Valor: Seu token NPM

### 3. Vari√°veis de Ambiente Locais

Para testes locais, crie um arquivo `.env` (nunca commite este arquivo!):

```bash
# .env (adicione ao .gitignore!)
GITHUB_TOKEN=seu_github_token_aqui
NPM_TOKEN=seu_npm_token_aqui
```

E adicione ao `.gitignore`:

```gitignore
# Environment variables
.env
.env.local
.env.*.local
```

---

## üöÄ Primeira Release

### 1. Preparar o Reposit√≥rio

```bash
# Certifique-se de estar na branch main
git checkout main

# Certifique-se de ter pelo menos um commit seguindo conven√ß√£o
git log --oneline

# Se n√£o tiver commits convencionais, fa√ßa um:
git commit --allow-empty -m "feat: configurar semantic-release"
```

### 2. Testar Localmente (Dry Run)

```bash
# Testar sem fazer a release real
npx semantic-release --dry-run

# Ver o que seria gerado:
# - Qual vers√£o seria criada
# - Quais commits seriam inclu√≠dos  
# - Qual changelog seria gerado
```

### 3. Executar a Primeira Release

#### Op√ß√£o 1: Manualmente (local)

```bash
# Com tokens configurados no .env ou vari√°veis de ambiente
npx semantic-release --no-ci
```

#### Op√ß√£o 2: Via GitHub Actions

```bash
# Fazer push para main (vai disparar o workflow)
git push origin main
```

### 4. Verificar Resultados

Ap√≥s a execu√ß√£o, verifique:

- ‚úÖ **Tag criada**: `git tag` deve mostrar a nova vers√£o
- ‚úÖ **CHANGELOG.md**: Arquivo criado com as mudan√ßas
- ‚úÖ **package.json**: Vers√£o atualizada
- ‚úÖ **GitHub Release**: Nova release no GitHub
- ‚úÖ **NPM Package**: Pacote publicado (se configurado)

---

## üõ†Ô∏è Troubleshooting

### Problemas Comuns e Solu√ß√µes

#### 1. **Erro: "No commits found"**

```
No git tag version found on branch main
No previous release found, retrieving all commits
Found 0 commits since last release
```

**Solu√ß√£o**: N√£o h√° commits que sigam a conven√ß√£o. Fa√ßa um commit v√°lido:

```bash
git commit --allow-empty -m "feat: primeira funcionalidade"
```

#### 2. **Erro: "Invalid GitHub token"**

```
EINVALIDGHTOKEN Invalid GitHub token
```

**Solu√ß√£o**: Verifique se o token est√° correto e tem as permiss√µes necess√°rias:

```bash
# Testar o token
curl -H "Authorization: token SEU_TOKEN" https://api.github.com/user
```

#### 3. **Erro: "No npm token specified"**

```
ENONPMTOKEN No npm token specified
```

**Solu√ß√µes**:
- Configure o `NPM_TOKEN` ou
- Remova o plugin `@semantic-release/npm` se n√£o quiser publicar

#### 4. **Erro: "Cannot require() ES Module"**

```
Cannot require() ES Module .releaserc.js
```

**Solu√ß√£o**: Use `.releaserc.mjs` para projetos ES Module ou `.releaserc.js` para CommonJS.

#### 5. **Workflow n√£o executa**

**Verifica√ß√µes**:
- ‚úÖ Arquivo est√° em `.github/workflows/`
- ‚úÖ Sintaxe YAML est√° correta
- ‚úÖ Push foi feito na branch `main`
- ‚úÖ GitHub Actions est√° habilitado no reposit√≥rio

#### 6. **Erro: "Push declined due to repository rule violations"**

```
Push cannot contain secrets
```

**Solu√ß√£o**: Remove tokens do c√≥digo e use vari√°veis de ambiente:

```bash
# Remover arquivo com tokens
git rm .env
git commit -m "fix: remove sensitive tokens"

# Adicionar ao .gitignore
echo ".env" >> .gitignore
git add .gitignore
git commit -m "chore: add .env to .gitignore"
```

### Comandos de Debug

```bash
# Ver logs detalhados
npx semantic-release --debug

# Testar configura√ß√£o
npx semantic-release --dry-run --debug

# Verificar plugins carregados
npx semantic-release --dry-run | grep "Loaded plugin"

# Verificar an√°lise de commits
npx semantic-release --dry-run | grep "Analysis of"
```

---

## üìö Recursos Adicionais

### Documenta√ß√£o Oficial
- [Semantic-Release](https://semantic-release.gitbook.io/)
- [Conventional Commits](https://www.conventionalcommits.org/)
- [Semantic Versioning](https://semver.org/)

### Plugins √öteis
- [@semantic-release/exec](https://github.com/semantic-release/exec) - Executar comandos customizados
- [@semantic-release/slack](https://github.com/juliuscc/semantic-release-slack-bot) - Notifica√ß√µes no Slack  
- [@semantic-release/discord](https://github.com/Fdawgs/semantic-release-discord) - Notifica√ß√µes no Discord

### Ferramentas Complementares
- [Commitizen](https://github.com/commitizen/cz-cli) - Interface para commits convencionais
- [Commitlint](https://github.com/conventional-changelog/commitlint) - Valida√ß√£o de commits
- [Husky](https://github.com/typicode/husky) - Git hooks

---

## üéØ Resumo dos Comandos

```bash
# Instala√ß√£o completa
npm install --save-dev semantic-release @semantic-release/changelog @semantic-release/git @semantic-release/github @semantic-release/npm

# Primeiro teste
npx semantic-release --dry-run

# Primeira release (local)
npx semantic-release --no-ci

# Debug
npx semantic-release --debug --dry-run

# Verificar vers√£o
npx semantic-release --version

# Ver tags criadas
git tag

# Ver commits desde √∫ltima release
git log $(git describe --tags --abbrev=0)..HEAD --oneline
```

---

**üéâ Pronto! Agora voc√™ tem um guia completo para implementar o Semantic-Release em qualquer projeto!**
